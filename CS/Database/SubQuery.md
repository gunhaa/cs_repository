# 서브 쿼리

- 서브쿼리란 SQL문 안에 포함된 또 다른 SQL문을 의미하며, 주로 특정 값을 조회하거나 조건을 만족하는 데이터를 검색할 때 사용된다

## 서브쿼리의 특징

1. 서브쿼리의 위치

- 서브쿼리는 일반적으로 WHERE 절에서 조건을 지정하는데 사용되지만, SELECT 절이나 FROM절에도 사용할 수 있다
  - FROM절에서 사용되는 서브쿼리를 Inline View라고 한다

2. 결과 컬럼 및 행의 수에 따른 구분

- 컬럼 수 기준
  - 단일 컬럼 서브쿼리
  - 서브 쿼리의 실행 결과로 하나의 컬럼을 반환
  - 다중 컬럼 서브쿼리
  - 서브 쿼리의 실행 결과로 여러 컬럼을 반환
- 행의 수 기준
  - 단일 행 서브쿼리
  - 서브 쿼리의 실행 결과로 항상 1건 이하의 행을 반환
  - 단일행 비교 연산자와 함께 사용(=, <, <=, >, >=, <>)
  - 다중행 서브쿼리
  - 서브쿼리의 실행 결과로 여러 건의 행 반환 가능
  - 메인 쿼리에서 다중행 비교 연산자와 함께 사용(IN, ALL, SOME, EXIST)

3. 메인쿼리와의 연관성에 따른 구분

- 연관(상관) 서브쿼리
  - 서브쿼리가 메인쿼리의 칼럼을 참조
    - 연관 서브쿼리는 메인쿼리의 컬럼을 서브쿼리에서 사용하는 구조를 갖는다
    - 메인 쿼리와 서브쿼리는 상호작용하며, 메인 쿼리의 값을 서브쿼리에서 활용하고 서브쿼리의 결과를 다시 메인쿼리에서 이용한다
      - 이로인해 메인 쿼리의 각 행마다 서브 쿼리가 반복적으로 실행된다
- 비연관 서브쿼리
  - 서브쿼리가 메인쿼리의 칼럼을 참조하지 않음
- 서브쿼리는 메인쿼리의 칼럼을 사용할 수 있지만, 메인쿼리는 서브쿼리의 컬럼을 사용할 수 없다
  - 단 Inline View에서 정의된 칼럼은 메인쿼리에서도 사용할 수 있다
    - SQL은 FROM 절을 가장 먼저 처리해서 작업할 데이터 집합을 확정한다
    - 메인 쿼리 입장에서는 인라인 뷰가 서브쿼리가 아니라, 처음부터 존재했던 진짜 테이블처럼 보인다
    - 메인 쿼리의 '테이블'의 컬럼들을 당연하게 사용할 수 있는 것이다
  - WHERE 절이나 SELECT 절에 있는 서브쿼리의 역할은 메인 쿼리에게 단순한 값이나 값의 목록을 전달하는 것이다 서브쿼리 내부의 복잡한 구조(컬럼 등)는 캡슐화되어 숨겨진다
    - 메인 쿼리는 서브쿼리가 어떤 과정을 거쳤는지, 내부적으로 어떤 컬럼을 사용했는지 알 필요도 없고 알 수도 없다


## 스칼라 서브쿼리

- 하나의 값을 반환하는 서브쿼리이다
- 결과가 단일행과 단일 컬럼으로 제한되며, 반환되는 값은 하나이다