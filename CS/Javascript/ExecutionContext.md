# 실행 컨텍스트

## 실행 컨텍스트란?

- 실행 컨텍스트(Execution Context)는 자바스크립트 코드가 실행되고 평가되는 환경에 대한 추상적인 개념이다. -
- 코드가 실행되기 위해 필요한 모든 정보를 담고 있는 객체라고 할 수 있다.
- 자바스크립트 엔진은 코드를 실행할 때 이 실행 컨텍스트를 생성하고, 이를 통해 변수, 함수, 스코프, this 바인딩 등을 관리한다.
- 코드가 실행되는 순간, 해당 코드에 대한 실행 컨텍스트가 생성되어 실행 컨텍스트 스택(Execution Context Stack), 다른 말로 콜 스택(Call Stack) 맨 밑에 쌓이게 된다.

## 실행 컨텍스트의 구성 요소

- 실행 컨텍스트는 크게 세 가지 주요 구성 요소로 이루어진다.

1. Variable Environment (변수 환경)

- 현재 컨텍스트 내의 var로 선언된 변수, 함수 선언문(function declaration) 등의 정보를 담고 있는 객체다.
- 실행 컨텍스트가 생성될 때 스냅샷처럼 만들어지며, 이후에는 변경되지 않는다.

2. Lexical Environment (렉시컬 환경)

- let, const로 선언된 변수, 함수 표현식(function expression) 등 식별자와 그 값, 그리고 외부 환경에 대한 참조를 기록하는 객체
- 렉시컬 환경은 환경 레코드(Environment Record)와 외부 렉시컬 환경 참조(Outer Lexical Environment Reference)로 구성된다.
- 환경 레코드 (Environment Record): 현재 스코프 내의 식별자(변수, 함수 이름)와 그 값을 기록하고 관리한다. 이것이 바로 '호이스팅(Hoisting)'이 발생하는 장소다.
- 외부 렉시컬 환경 참조 (Outer Lexical Environment Reference): 현재 실행 컨텍스트가 포함된 외부 스코프, 즉 상위 스코프의 렉시컬 환경을 참조한다. 이를 통해 자바스크립트는 스코프 체인(Scope Chain)을 구현하며, 내부 함수가 외부 함수의 변수에 접근할 수 있게 된다.

3. this Binding

- this 키워드가 참조할 객체를 결정한다.
- this의 값은 함수가 어떻게 호출되었는지에 따라 동적으로 결정된다. (예: 일반 함수 호출, 메서드 호출, new 키워드를 사용한 생성자 호출 등)

## 실행 컨텍스트의 종류

실행 컨텍스트는 다음과 같이 세 가지 종류로 나뉜다.

1. 전역 실행 컨텍스트 (Global Execution Context, GEC): 자바스크립트 파일이 처음 실행될 때 생성되는 가장 기본적인 실행 컨텍스트다. 단 하나만 존재하며, 웹 브라우저 환경에서는 window 객체를, Node.js 환경에서는 global 객체를 this로 바인딩한다. 전역 변수와 전역 함수가 이 컨텍스트에 속한다.

   - 전역 실행 컨텍스트(GEC)는 항상 콜 스택의 가장 아래에 존재한다(코드가 완전히 종료되기 전까지 계속)

2. 함수 실행 컨텍스트 (Function Execution Context, FEC): 함수가 호출될 때마다 해당 함수를 위한 새로운 실행 컨텍스트가 생성된다. 각 함수는 자신만의 실행 컨텍스트를 가지며, 여기에는 해당 함수의 매개변수, 지역 변수, arguments 객체 등이 포함된다.

3. Eval 실행 컨텍스트 (Eval Execution Context): eval() 함수 내부의 코드를 위해 생성되는 실행 컨텍스트다. 보안 및 성능상의 이유로 사용이 권장되지 않는다.

## 실행 컨텍스트 스택 (콜 스택)

- 자바스크립트 엔진은 실행 컨텍스트를 관리하기 위해 실행 컨텍스트 스택(콜 스택) 이라는 자료구조를 사용한다.

1. 스크립트가 처음 실행되면, 자바스크립트 엔진은 전역 실행 컨텍스트(GEC)를 생성하고 콜 스택에 푸시(push)한다.
2. 함수가 호출되면, 엔진은 해당 함수를 위한 함수 실행 컨텍스트(FEC)를 생성하고 콜 스택의 최상단에 푸시한다.
3. 콜 스택의 최상단에 위치한 실행 컨텍스트가 현재 실행 중인 컨텍스트가 된다.
4. 함수 실행이 완료되면, 해당 함수의 실행 컨텍스트는 콜 스택에서 팝(pop)되고, 제어권은 스택의 바로 아래에 있는 컨텍스트로 이동한다.
5. 모든 코드 실행이 끝나면 전역 실행 컨텍스트도 스택에서 팝되고, 콜 스택은 비워진다.

## 실행 컨텍스트의 생성과 실행 과정

- 실행 컨텍스트는 생성 단계(Creation Phase)와 실행 단계(Execution Phase) 두 단계로 나뉘어 처리된다.

### 1. 생성 단계 (Creation Phase)

- 코드를 실행하기 전에 실행 컨텍스트를 생성하는 단계

1. 렉시컬 환경 생성: 환경 레코드와 외부 렉시컬 환경 참조를 결정한다.
2. 변수 환경 생성: 렉시컬 환경과 동일한 내용으로 생성된다.
3. 호이스팅 발생
   - 함수 선언문: 함수 전체를 메모리에 올린다. 따라서 함수 선언 전에 호출이 가능하다.
   - var 변수: 변수 선언만 메모리에 올리고 undefined로 초기화한다. 값 할당은 실행 단계에서 이루어진다.
   - let, const 변수: 변수 선언만 메모리에 올리지만 초기화는 하지 않는다. 이로 인해 선언 전에 접근하면 TDZ(Temporal Dead Zone) 에 해당하여 참조 에러(ReferenceError)가 발생한다.
4. this 바인딩: this가 참조할 객체를 결정한다.
5. 스코프 체인 결정: 외부 렉시컬 환경 참조를 설정하여 스코프 체인을 구성한다.

## 2. 실행 단계 (Execution Phase)

- 생성 단계를 마친 후, 코드를 위에서 아래로 한 줄씩 실행하는 단계다.

1. 변수에 값을 할당한다.
2. 함수를 호출한다. (이때 새로운 함수 실행 컨텍스트가 생성된다.)
3. 코드의 다른 구문들을 실행한다.
