# Main Memory

- A process is a program in execution
  - to say, a set of instructions kept in a main memory
- A memory consists of
  - A large array of bytes, each with its own address
  - CPU fetches instructions from memory using the program counter,
  - and instructions may cause load from and store to the memory
- Memory Space
  - We need to make sure that each process had a seperate memory space
  - A pair of registers: base(기준) register and limit(상한) register
    - provides the ability to determine the range of legal addresses
- Protection of memory space
  - is accomplished by having the CPU hardware
    - compare every address generated in user mode with the registers
    - trap to operation system illegal addressing error
- Logical vs Physical Address Space
  - logical address: an address generated by the CPU
  - physical address: an address seen by the memory unit
    - that is, the one loaded into the memory-address register
- MMU(Memory Management Unit)
  - a hardware device that maps from logical address to physical address
    - use relocation register: 숫자가 들어있고, 이 숫자만큼 logical address에 더해 physical address를 구한다(e.g. relocation register: 10000, logical address: 444, physical address: 10444)
- DLL은 메모리에 모든 함수를 올리는 것이 아니고, 디스크에 저장된 함수를 매핑시키는 역할을 해 필요할때 디스크에서 코드 덩어리(함수)를 불러와 **RAM에 올리고 이를 계속해서 사용한다
  - 링킹을 통해 C,C++에서 연결되며, JVM에서는 ClassLoader를 통해 이 역할을 수행한다
    - C,C++,Java 등 많은 언어에서 Memory에 모든 것을 올리지 않고 디스크에 함수들을 저장해놓고 필요한 것을 메모리에 올리는 방식이다

## Basic Hardware

- 메인 메모리와 각 처리 코어에 내장된 레지스터들 CPU가 직접 접근할 수 있는 유일한 범용 저장장치이다
- 명령어는 메모리 주소만을 인수로 취하고, 디스크 주소를 인수로 취하지 않는다
  - 따라서 실행되는 명령어와 데이터들은 CPU가 직접적으로 접근 할 수 있는 메인메모리 혹은 레지스터에 있어야 한다
  - 만약 데이터가 메모리에 없다면 CPU가 그것들을 처리하기 전에 메모리로 이동시켜야 한다
- 각 CPU core에 저장된 레지스터들은 일반적으로 CPU clock 1cycle내에 접근이 가능하다
  - 처리 코어들은 레지스터에 있는 명령어의 해독과 간단한 연산을 clock tick당 하나 또는 그 이상의 속도로 처리한다
  - 그러나 메모리 버스를 통해 전송되는 메인 메모리의 경우는 앞에서 언급했던 상황과는 다르게, 메인 메모리의 접근을 완료하기 위해서는 많은 CPU clock tick cycle이 소요되며, 이 경우 CPU가 필요한 데이터가 없어서 명령어를 수행하지 못하고 지연되는(stall) 현상이 발생하게 된다
    - 이런 상황은 메인 메모리의 접근이 빈번하게 일어나는 경우에는 용납될 수 없다
    - 이 경우 해결 방법은 CPU와 메모리 사이에 빠른 속도의 메모리를 추가하는 것이다(1,2,3차 캐시메모리)
    - 이렇게 stall되는 동안에는 다른 스레드로 context switching이 가능하다(Cache miss시)

## Paging

> `CPU에서 나오는 모든 주소는 페이지번호(p)와 페이지 오프셋(d:offset) 두 개의 부분으로 나누어진다`

- a memory management scheme that permits
  - a process's physical address space to be non-contiguous
- overcomes two problems of contiguous memory allocation
  - avoid external fragment
  - avoid the associated need for compaction
- implemented through 
  - cooperation between the operating system and the computer hardware
- basic method for paging
  - break physical memory into fixted-sized blocks(frames), 물리적 메모리를 프레임이라 불리는 같은 크기 블록으로 나눈다
  - and break logical memory into blocks of the same size(pages), 논리 메모리는 페이지라 불리는 같은 크기의 블록으로 나눈다
  - the logical address space is totally seperate from the physical address space