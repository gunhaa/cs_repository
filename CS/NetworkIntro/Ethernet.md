# (Data) Link Layer(Ethernet)

- 하나의 LAN(Local Area Network) 내에서 장치 간 데이터를 전송하기 위한 프로토콜
  - 링크 계층의 기본 서비스는 단일 통신 링크상으로 데이터그램을 한 노드에서 인접 노드로 '이동' 시키는 것이다
  - 링크 계층의 프로토콜이 제공하는 서비스는 다음과 같다
    1. 프레임화: Network layer의 packet을 frame으로 캡슐화한다
    2. 링크 접속: 매체 접속 제어(mediun access control, MAC) protocol은 링크상 프레임을 전송하는 규칙을 명시한다. point to point의 경우 단순하게 동작하며, 하나의 broadcast link를 공유하는 경우 MAC이 node로부터의 전송을 조정한다 
    3. 신뢰적 전달: 신뢰적 전달 기능을 제공하는 경우 링크상에서 오류없이 전달된다. (TCP와 같은) 일부 트랜스포트 계층 프로토콜에서는 신뢰적 전달 서비스를 제공한다
    4. 오류 검출과 정정: 송신 노드에서 오류 검출 비트를 설정하게하고 수신 노드에서 오류 검사를 수행하게 함으로써 가능하다. Link layer의 일반적인 서비스이다
- 링크 계층은 두 종류가 있다
  1. 브로드 캐스트 채널(무선랜, 위성 네트워크)
  2. point to point(원거리 링크에 의해 연결된 두 라우터 또는 사용자의 사무실 컴퓨터와 이더넷 스위치 사이)
- 링크 계층은 네트워크 인터페이스 컨트롤러(Network Interface Controller, NIC)로 알려진 네트워크 어댑터에 구현된다
  - NIC에서 link layer service의 동작이 구현되어있다(packet to frame, link connect, 오류 검출)
    - 물리적으로 인접한 두 장치(호스트 ↔ 스위치, 스위치 ↔ 스위치 등) 사이의 데이터 링크 계층 수준의 연결
    - MAC 주소를 기반으로 한 연결 인식 및 통신 관계 형성이 핵심

## 용어

- backoff algorithm
  - 충돌 후 잠시 물러서서 다시 전송하는 절차
- node
  - 링크 계층에서 프로토콜을 실행하는 장치
  - wifi access point, switch, router, host

## 오류 검출 및 정정

### 패리티 검사

- parity bit를 사용해 오류를 검출한다
  - 짝수(홀수) 패리티: d의 길이에 비트를 추가하고 d+1개의 합이 짝수(홀수)가 되도록하는 것
  - 문제: 짝수개의 오류는 확인 불가

### 체크섬

- TCP/UDP에서 주로 사용되는 방법이다
  - 데이터를 여러 블록으로 나누고, 이들을 더한 합의 보수를 전송 시 포함
  - 수신 측에서 다시 더해 합이 0(또는 0xFFFF) 이 되면 정상으로 간주
- 체크섬 방식은 CRC에 비하면 오류 면에서 상대적으로 취약하다
  - link layer에서는 주로 CRC방식을 사용한다

### CRC Cyclic Redundancy Check

- 데이터 비트를 이진 다항식(binary polynomial) 으로 보고, 송신 측에서 미리 정해진 생성 다항식(G(x)) 으로 나누어 나머지(R) 를 붙여 전송
- 계산 복잡도가 다소 높아 소프트웨어 계층보다는 하드웨어 구현에 적합해서 link layer에서 사용된다

#### 왜 검증을 Transport(TCP/UDP), Network Layer 두군데에서 함?

- 링크 계층(Ethernet) 은 패킷의 가장 첫 전달 지점이다
  - 만약 여기서 비트 하나라도 잘못되면, 상위 계층으로 올라가는 모든 데이터가 잘못된다
  - TCP처럼 재전송이 있는 계층과 달리, 링크 계층은 “오류만 검출하고 폐기(drop)” 하는 역할이므로 거의 완벽하게 오류를 검출할 필요가 있다
- 계층마다 “책임 범위”가 다르기 때문이다
  - CRC와 체크섬은 중복이 아니라 보장 범위가 다른 “이중 안전망” 이다
- CRC는 “링크(구간)” 단위만 보장
  - 패킷이 LAN 한 구간을 지나갈 때마다 해당 구간의 하드웨어(NIC, 스위치)가 CRC를 검증하고 오류 있으면 폐기(drop) 다음 구간으로 갈 때는 새로 계산된 CRC를 붙인다.
  - 즉, CRC는 “매 홉(hop)” 마다 새로 생성되고, 전송 중 변경될 수 있다
- TCP/UDP 체크섬은 “종단 간(end-to-end)” 보장
  - 즉, 송신 애플리케이션 → 수신 애플리케이션까지 전체 경로(End-to-End) 에 대해 데이터를 보장하기 위함이다
  - 중간 라우터들은 IP 헤더만 수정하고(예: TTL 감소, 헤더 체크섬 다시 계산), 데이터(payload)는 건드리지 않지만, 전송 중 다른 이유로(버그, 메모리 오류, 드라이버 손상 등) 데이터가 변형될 수 있다
  - 그래서 TCP/UDP는 “전송 중 링크가 바뀌더라도, 최종 수신자가 받은 데이터가 송신자가 보낸 데이터와 일치하는가?”를 확인하기 위해 체크섬을 한 번 더 수행한다

## 다중 접속 문제

- `다수의 송수신 노드들의 공유되는 브로드 캐스트 채널로의 접속을 조정하는 문제`


### Ethernet의 원형 Aloha net